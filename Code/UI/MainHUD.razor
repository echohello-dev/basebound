@using Sandbox;
@using Sandbox.UI;
@using Basebound.Player;
@using Basebound.PawnSystem;
@inherits PanelComponent
@namespace Basebound.UI

@if (!IsHudEnabled) return;

<root>
	<canvas>
		@if (Bridge.HasViewer)
		{
			@* Vitals - Health bar *@
			<div class="vitals @(Bridge.IsCriticalHealth ? "critical" : "")">
				<div class="health-container">
					<div class="health-bar">
						<div class="health-fill" style="width: @(Bridge.HealthPercent)%"></div>
					</div>
					<div class="health-text">
						<span class="current">@Bridge.CurrentHealth</span>
						<span class="separator">/</span>
						<span class="max">@Bridge.MaxHealth</span>
					</div>
				</div>
			</div>
		}
		else
		{
			<div class="title muted">Waiting for player...</div>
		}

		@* Spectate indicator *@
		@if (Bridge.IsSpectating)
		{
			<div class="spectate-indicator">Spectating: @Bridge.ViewerName</div>
		}

		@* Debug overlay - toggle with bb_debughud *@
		@if (ShowDebugHud)
		{
			<div class="debug-panel">@Bridge.DebugInfo</div>
		}
	</canvas>
</root>

@code {
	/// <summary>
	/// Reference to the HudDataBridge on the same GameObject.
	/// Razor panels should read from this bridge, not from game objects directly.
	/// </summary>
	[RequireComponent]
	public HudDataBridge Bridge { get; set; }

	[ConVar("bb_drawhud")]
	public static bool IsHudEnabled { get; set; } = true;

	[ConVar("bb_debughud")]
	public static bool ShowDebugHud { get; set; } = false;

	/// <summary>
	/// The hash determines if the system should be rebuilt. If it changes, it will be rebuilt.
	/// </summary>
	protected override int BuildHash()
	{
		return System.HashCode.Combine(
		IsHudEnabled,
		ShowDebugHud,
		Bridge.HasViewer,
		Bridge.CurrentHealth,
		Bridge.IsSpectating
		);
	}
}