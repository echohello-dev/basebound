@using Sandbox;
@using Sandbox.UI;
@using Basebound.UI;
@using Basebound.Player;
@using Basebound.PawnSystem;
@inherits PanelComponent
@namespace Basebound.UI

@if (!IsHudEnabled) return;

<root>
	<canvas>
		<KillFeed />

		@if (Bridge?.HasViewer ?? false)
		{
			<Vitals Bridge=@Bridge />
		}
		else
		{
			<div class="title muted">Waiting for player...</div>
		}

		@* Spectate indicator *@
		@if (Bridge?.IsSpectating ?? false)
		{
			<div class="spectate-indicator">Spectating: @Bridge.ViewerName</div>
		}

		@* Debug overlay - toggle with bb_debughud *@
		@if (ShowDebugHud)
		{
			<DebugViewerPanel Bridge=@Bridge />
		}
	</canvas>
</root>

@code {
	/// <summary>
	/// Reference to the HudDataBridge on the same GameObject.
	/// Razor panels should read from this bridge, not from game objects directly.
	/// </summary>
	[RequireComponent]
	public HudDataBridge Bridge { get; set; }

	[ConVar("bb_drawhud")]
	public static bool IsHudEnabled { get; set; } = true;

	[ConVar("bb_debughud")]
	public static bool ShowDebugHud { get; set; } = false;

	/// <summary>
	/// The hash determines if the system should be rebuilt. If it changes, it will be rebuilt.
	/// </summary>
	protected override int BuildHash()
	{
		return System.HashCode.Combine(
		IsHudEnabled,
		ShowDebugHud,
		Bridge?.HasViewer ?? false,
		Bridge?.CurrentHealth ?? 0,
		Bridge?.IsSpectating ?? false
		);
	}
}